{% extends 'components/base.html' %} {% load static %} {% block content %}
<link rel="stylesheet" href="{%static '/css/create_post.css'%}">
<form method="POST"> {% csrf_token %}
    <div class="container">
        <div class="blog-header-container style-container">
            <div class="title">
                <div class="title-text">หัวข้อกระทู้</div>
                <div id="header_count" class="count-text">0/120</div>
            </div>
            <div class="blog-header">
                <input type="text" id="header_text" class="header-input blogfont" autocomplete="off" placeholder="หัวข้อกระทู้" required>
            </div>
        </div>
        <div class="blog-body-container style-container">
            <div class="title">
                <div class="title-text">เนื้อหากระทู้</div>
                <div id="body_count" class="count-text">0/4000</div>
            </div>
            <div class="blog-body">
                <textarea id="body_text" class="body-input blogfont" rows="10" placeholder="เนื้อหากระทู้" required></textarea>
            </div>
        </div>
        <div class="chooseroom-container style-container">
            <div class="title">
                <div class="title-text">เลือกห้อง</div>
                <div class="need">*จำเป็น</div>
            </div>
            <div class="all-room">
                <input type="radio" class="input" id="review" name="room" value="room_review">
                <div class="room-container">
                    <label for="review"><img src="/statics/images/review.png"><br>รีวิว</label>
                </div>

                <input type="radio" class="input" id="news" name="room" value="room_news">
                <div class="room-container">
                    <label for="news"><img src="/statics/images/news.png"><br>ข่าวสาร</label>
                </div>

                <input type="radio" class="input" id="educate" name="room" value="room_educate">
                <div class="room-container">
                    <label for="educate"><img src="/statics/images/educate.png"><br>เด็กเรียน</label>
                </div>

                <input type="radio" class="input" id="dorm" name="room" value="room_dorm">
                <div class="room-container">
                    <label for="dorm"><img src="/statics/images/dorm.png"><br>หอพัก</label>
                </div>

                <input type="radio" class="input" id="food" name="room" value="room_food">
                <div class="room-container">
                    <label for="food"><img src="/statics/images/food.png"><br>มุมอร่อย</label>
                </div>

                <input type="radio" class="input" id="sport" name="room" value="room_sport">
                <div class="room-container">
                    <label for="sport"><img src="/statics/images/sport.png"><br>กีฬา</label>
                </div>

                <input type="radio" class="input" id="travel" name="room" value="room_travel">
                <div class="room-container">
                    <label for="travel"><img src="/statics/images/travel.png"><br>ท่องเที่ยว</label>
                </div>

                <input type="radio" class="input" id="art" name="room" value="room_art">
                <div class="room-container">
                    <label for="art"><img src="/statics/images/art.png"><br>งานอาร์ต</label>
                </div>

                <input type="radio" class="input" id="pet" name="room" value="room_pet">
                <div class="room-container">
                    <label for="pet"><img src="/statics/images/pet.png"><br>สัตว์เลี้ยง</label>
                </div>

                <input type="radio" class="input" id="fashion" name="room" value="room_fashion">
                <div class="room-container">
                    <label for="fashion"><img src="/statics/images/fashion.png"><br>แฟชั่น</label>
                </div>

                <input type="radio" class="input" id="camera" name="room" value="room_camera">
                <div class="room-container">
                    <label for="camera"><img src="/statics/images/camera.png"><br>ถ่ายรูป</label>
                </div>

                <input type="radio" class="input" id="party" name="room" value="room_party">
                <div class="room-container">
                    <label for="party"><img src="/statics/images/party.png"><br>ปาร์ตี้</label>
                </div>

                <input type="radio" class="input" id="talk" name="room" value="room_talk">
                <div class="room-container">
                    <label for="talk"><img src="/statics/images/talk.png"><br>คุยเล่น</label>
                </div>

                <input type="radio" class="input" id="other" name="room" value="room_other">
                <div class="room-container">
                    <label for="other"><img src="/statics/images/other.png"><br>อื่น ๆ</label>
                </div>
            </div>
        </div>
        <div class="tag-container style-container">
            <div class="title">
                <div class="title-text">แท็ก</div>
                <div id="tag_count" class="count-text">0/50</div>
            </div>
            <div class="blog-tag-container">
                <div class="all-tag">
                    <textarea maxlength="50" rows="1" id="tag_input" class="tag-input" placeholder="เพิ่มแท็ก" autocomplete="off"></textarea>
                </div>
            </div>
        </div>
        <div class="blog-cover-container style-container">
            <div class="title-text" style="margin-bottom:5px">ปกกระทู้</div>
            <label for="cover_blog_img" class="add-cover">เพิ่มรูปปก</label>
            <input type="file" accept="image/*" name="cover_image" id="cover_blog_img" style="pointer-events: none;">
        </div>
        <div class="blog-set-time-container style-container">
            <div class="title">
                <div class="title-text">ตั้งเวลาลบกระทู้</div>
                <div class="need">*จำเป็น</div>
            </div>
            <div class="set-time">
                <div class="choose-set-time">
                    <input type="radio" class="time-input" id="set_time" name="time" value="time_set">
                    <div class="time-container">
                        <label for="set_time">กำหนดเวลา</label>
                    </div>

                    <input type="radio" class="time-input" id="unset_time" name="time" value="time_unset">
                    <div class="time-container">
                        <label for="unset_time">ไม่กำหนด</label>
                    </div>
                    <input type="datetime-local" class="date-time" id="date_time">
                </div>
            </div>
        </div>
        <button type="submit" id="submit_form" class="create-blog-btn redorange vhcenter" disabled>ตั้งกระทู้เลย</button>
    </div>
</form>

<script>
    //var for enable disable submit
    var header, body,
        room = false,
        unsetTime = false,
        setTime = false;
    //----------------set min max date today (+7 day from today)---------------------
    var dateTime = document.getElementById("date_time")
    dateTime.addEventListener("click", function() {
        //today date
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();
        var hours = today.getHours();
        var minutes = today.getMinutes();
        //max date
        var adddate = today.setDate(today.getDate() + 7);
        var maxdate = new Date(adddate);
        var maxdd = maxdate.getDate();
        var maxmm = maxdate.getMonth() + 1; //January is 0!
        var maxyyyy = maxdate.getFullYear();
        var maxhours = maxdate.getHours();
        var maxminutes = maxdate.getMinutes();
        //check today date
        if (dd < 10) {
            dd = '0' + dd;
        }

        if (mm < 10) {
            mm = '0' + mm;
        }

        if (hours < 10) {
            hours = '0' + hours;
        }

        if (minutes < 10) {
            minutes = '0' + minutes;
        }
        //check max date
        if (maxdd < 10) {
            maxdd = '0' + maxdd;
        }

        if (maxmm < 10) {
            maxmm = '0' + maxmm;
        }

        if (maxhours < 10) {
            maxhours = '0' + maxhours;
        }

        if (maxminutes < 10) {
            maxminutes = '0' + maxminutes;
        }
        today = yyyy + '-' + mm + '-' + dd + 'T' + hours + ":" + minutes;
        maxdate = maxyyyy + '-' + maxmm + '-' + maxdd + 'T' + maxhours + ":" + maxminutes;
        dateTime.setAttribute('min', today)
        dateTime.setAttribute('max', maxdate)

    });
    //----------------set min time today (+10min from now)---------------------
    dateTime.addEventListener("input", function() {
        //today plus 10 minutes date
        var today = new Date();
        var adddate = today.setMinutes(today.getMinutes() + 10);
        var todayPlus = new Date(adddate);
        var ddPlus = todayPlus.getDate();
        var mmPlus = todayPlus.getMonth() + 1; //January is 0!
        var yyyyPlus = todayPlus.getFullYear();
        var hoursPlus = todayPlus.getHours();
        var minutesPlus = todayPlus.getMinutes();
        //check today plus 10 minutes date
        if (ddPlus < 10) {
            ddPlus = '0' + ddPlus;
        }

        if (mmPlus < 10) {
            mmPlus = '0' + mmPlus;
        }

        if (hoursPlus < 10) {
            hoursPlus = '0' + hoursPlus;
        }

        if (minutesPlus < 10) {
            minutesPlus = '0' + minutesPlus;
        }
        var todayPlusFullDate = yyyyPlus + '-' + mmPlus + '-' + ddPlus + 'T' + hoursPlus + ':' + minutesPlus;
        var todayPlusDate = yyyyPlus + '-' + mmPlus + '-' + ddPlus;
        //input date
        if (dateTime.value) {
            var input = dateTime.value;
            var inputDate = input.split('T')[0];
            var inputTime = input.split('T')[1];
            var inputdd = inputDate.split('-')[2];
            var inputmm = inputDate.split('-')[1];
            var inputyyyy = inputDate.split('-')[0];
            var inputMinutes = inputTime.split(':')[1];
            var inputHours = inputTime.split(':')[0];
            if (inputyyyy <= yyyyPlus) {
                if (inputmm <= mmPlus) {
                    if (inputdd <= ddPlus) {
                        if (inputHours <= hoursPlus) {
                            if (inputMinutes <= minutesPlus) {
                                $('#date_time').val(todayPlusFullDate);
                            }
                        }
                    }
                }
            }
        }
        //-----------time set checked------------
        console.log(dateTime.value);
        if (dateTime.value == '') {
            setTime = false;
        } else {
            setTime = true;
        }
        if (header && body && room && (unsetTime || setTime)) {
            document.getElementById("submit_form").disabled = false;
        } else {
            document.getElementById("submit_form").disabled = true;
        }
    });

    //-----------time set checked------------
    var unset = document.querySelector('#unset_time');
    var set = document.querySelector('#set_time');
    unset.addEventListener("click", function() {
        if (unset.checked == true) {
            dateTime.value = '';
            setTime = false;
            unsetTime = true;
        }
    });
    set.addEventListener("click", function() {
        if (set.checked == true) {
            unsetTime = false;
        }
    });

    //----------------limit text---------------------
    function count_word(val) {
        var wom = val.match(/.+/g);
        var len = 0;
        if (wom) {
            len = wom[0].length;
        }
        return len;
    }

    //-----------room checked------------
    var roomArray = document.querySelectorAll('input[name=room]');
    for (var i = 0; i < roomArray.length; i++) {
        roomArray[i].addEventListener("click", function() {
            console.log(header, body, room, unsetTime, setTime);
            console.log(header && body && room && (unsetTime || setTime));
            room = true;
        });
    }


    //----------------limit header text---------------------
    var headerTextContent = document.getElementById("header_text");
    var headerShowWordCount = document.getElementById("header_count");
    headerTextContent.addEventListener("input", function() {
        var len = count_word(this.value);
        var limit_text_min = 4;
        var limit_text_max = 120;
        headerShowWordCount.innerHTML = String(len) + "/" + String(limit_text_max);
        if (len > limit_text_max || (len < limit_text_min && len != 0)) {
            headerShowWordCount.classList.add("overflow-text");
        } else {
            headerShowWordCount.classList.remove("overflow-text");
        }
        //---------------enable disable submit button-------------
        if (len > limit_text_max || len < limit_text_min) {
            header = false;
        } else {
            header = true;
        }
        if (header && body && room && (unsetTime || setTime)) {
            document.getElementById("submit_form").disabled = false;
        } else {
            document.getElementById("submit_form").disabled = true;
        }
    });

    //----------------limit body text---------------------
    var bodyTextContent = document.getElementById("body_text");
    var bodyShowWordCount = document.getElementById("body_count");
    bodyTextContent.addEventListener("input", function() {
        var len = count_word(this.value);
        var limit_text_min = 6;
        var limit_text_max = 4000;
        bodyShowWordCount.innerHTML = String(len) + "/" + String(limit_text_max);
        if (len > limit_text_max || (len < limit_text_min && len != 0)) {
            bodyShowWordCount.classList.add("overflow-text");
        } else {
            bodyShowWordCount.classList.remove("overflow-text");
        }
        //---------------enable disable submit button-------------
        if (len > limit_text_max || len < limit_text_min) {
            body = false;
        } else {
            body = true;
        }
        if (header && body && room && (unsetTime || setTime)) {
            document.getElementById("submit_form").disabled = false;
        } else {
            document.getElementById("submit_form").disabled = true;
        }
    });
    //----------------limit tag text---------------------
    var TagTextContent = document.getElementById("tag_input");
    var TagShowWordCount = document.getElementById("tag_count");
    TagTextContent.addEventListener("input", function() {
        var len = count_word(this.value);
        var limit_text_max = 50;
        TagShowWordCount.innerHTML = String(len) + "/" + String(limit_text_max);
    });
    //---------------tag--------------------
    let container = document.querySelector('.all-tag')
    let input = document.getElementById('tag_input');
    input.addEventListener('keyup', (event) => {
        input.classList.remove('no-sp-text');
        if ((event.which == 32 || event.which == 13) && input.value.length > 0) {
            var p = document.createElement('p');
            var text = input.value;
            text = text.replace(/[&\/\\#^+()$~%.'":;, ฿=_\-*?\n<>{}!@`\[\]|]/g, '');
            if (text) {
                text = '#' + text;
                var text_node = document.createTextNode(text);
                input.parentNode.insertBefore(p, input);
                p.appendChild(text_node);
                p.classList.add('post-tag');
                input.value = '';
            } else {
                input.classList.add('no-sp-text');
            }

            let deleteTags = document.querySelectorAll('.post-tag');

            for (let i = 0; i < deleteTags.length; i++) {
                deleteTags[i].addEventListener('click', () => {
                    container.removeChild(deleteTags[i]);
                });
            }
        }
    });
    //----------------prevent form submit---------------   
    document.querySelector('form').addEventListener("click", function() {
        //---------------enable disable submit button-------------
        if (header && body && room && (unsetTime || setTime)) {
            document.getElementById("submit_form").disabled = false;
        } else {
            document.getElementById("submit_form").disabled = true;
        }
    });
    $('form').submit(function(event) {
        if (header && body && room && (unsetTime || setTime)) {
            return true;
        } else {
            return false;
        }
    });
</script>
{% endblock content %}